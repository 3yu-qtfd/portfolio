## Terraformとは

インフラのコード化を行うためのツール。listを使って繰り返し処理を書けるなどメリットが多数ある。  
デメリットは、CloudFormationに比べるとAWSの最新機能にすぐ追いつけないことなど。  
過去にはコード規約の変更で、インフラ環境に変更が無くてもコードの互換性がなく変更が必要になったことも。  
ただし、デメリットを上回るメリットがあり、多くの企業で採用されている。 

### Terraformハンズオンメモ
ハンズオンを行い、一通りの使い方を確認する。

#### セットアップ 
1. Terraform用のディレクトリを作成する。
2. Providerの設定を行う。
  ※Provider：Terraformと各種クラウドのAPIを取り持つ存在。アクセスキーを書く際は変数化などする。 
3. initで初期化する。  
 ※backendを追加した場合、module自体やmodule参照箇所を追加した場合もinitが必要。 
4. コードを記述し、環境構築していく。

#### 使用コマンド 
`terraform fmt`  コードの整形 
`terraform validate`  構文チェック 
`terraform plan`  ドライラン 
`terraform apply`  実行　※実行フォルダ内のtfファイルすべてが対象。リソースの指定も可能。 

#### 使用ファイル
- 「.tf」：コードを記述して作る設定ファイル。変数定義が可能。  
- 「.tfvars」：変数を記述する設定ファイル。「terraform.tfvars」のファイル名にすると必ず読み込まれる。  
- 「.tfstate」：applyを実行した際の状態を記録したJSONファイル。  
  ※tfstateがなくなると、どの環境をTerraformで構築したか判断できなくなるため、保管や管理が重要。  

#### Backend機能
tfstateをリモートストレージで管理する機能。AWSではS3バケットに格納するのが基本。  
業務で扱う場合は、S3のバージョニングも有効にすることが多い。  
なお、排他ロックが必要な場合はDynamoDBを組み合わせて使う。  

#### moduleとは
リソースや機能単位で分割したtfファイルのこと。テンプレートとしてmoduleを用意し使い回すことができ、リソースの分離が出来る。  
1. dev,stage,prodで変数ファイル用のディレクトリを分け、moduleはmodule用のディレクトリに配置  
2. moduleをリソースごとのディレクトリに分けて配置（この場合あまりmodule化する利点は無いが）　など 

#### workspaceとは
Gitブランチのように別々の環境を複数構築できる仕組みのこと。  
専用コマンドでワークスペースを作成する。ワークスペースごとにtfstateが生成される。